#!/usr/bin/env python
import os
import logging
from interfaces.imalwarecorpusfactory import IMalwareCorpusFactory
from ramresidentmc import RamResidentMC
from testmalware import TestMalware

log = logging.getLogger(__name__)

class TestMalwareDirectoryFactory(IMalwareCorpusFactory):

	def __init__(self):
		self.ramcorpus = RamResidentMC()
		self.validapk = 0
		self.nonvalidapk = 0

	def create(self,directory):
		listing = os.listdir(directory)
		for file in listing:
			temp = directory+"/"+file
			log.info("File name "+temp)
			self.process_test_malware_file(temp)
		self.ramcorpus.mc_sort()

	def process_test_malware_file(self,file):
		log.info("inside process apk files")
		try:
			log.info("Creating APK object")
			malware = TestMalware(file)
			log.info("Adding APK object to ramcorpus")
			self.ramcorpus.add(malware)
			log.info("incrementing counter for validapk")
			self.validapk += 1
		except:
			log.info("Exception why")
			self.nonvalidapk += 1
		
		
	def get_corpus(self):
		return self.ramcorpus
